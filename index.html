<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Viagem para Gramado</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Segoe UI', sans-serif;
  background:linear-gradient(180deg,#dbeafe,#bfdbfe,#e0f2fe);
  display:flex;
  justify-content:center;
  padding:25px;
  overflow-x:hidden;
}
.snowflake{
  position:fixed;
  top:-10px;
  color:white;
  animation:fall linear infinite;
  opacity:0.9;
}
@keyframes fall{to{transform:translateY(110vh)}}

.container{
  backdrop-filter: blur(14px);
  background:rgba(255,255,255,0.75);
  width:100%;
  max-width:600px;
  border-radius:22px;
  padding:22px;
  box-shadow:0 25px 50px rgba(0,0,0,0.15);
}

h1{text-align:center;color:#1e3a8a;margin-bottom:10px}

input,select{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:12px;
  border:1px solid #c7d2fe;
  font-size:13px;
}

button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border:none;
  border-radius:12px;
  font-weight:bold;
  cursor:pointer;
}
.primary{background:#3b82f6;color:white}
.danger{background:#64748b;color:white}

.viagem{
  background:white;
  margin-top:15px;
  padding:14px;
  border-radius:16px;
  border:1px solid #dbeafe;
}

.categoria-header{
  display:flex;
  justify-content:space-between;
  background:linear-gradient(90deg,#60a5fa,#3b82f6);
  color:white;
  padding:7px 10px;
  border-radius:10px;
  margin-top:8px;
  cursor:pointer;
  font-size:13px;
  font-weight:bold;
}

.gastos-lista{
  display:none;
  margin-top:6px;
  padding:6px;
  background:#f0f9ff;
  border-radius:10px;
}

.gasto{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  margin:6px 0;
  padding:4px 0;
  border-bottom:1px dashed #cfe8ff;
}

.pago{text-decoration:line-through;color:#16a34a;font-weight:bold}

.resumo{
  margin-top:10px;
  background:#f0f9ff;
  padding:10px;
  border-radius:10px;
  font-size:12px;
  border:1px solid #bae6fd;
  line-height:1.6;
}

.extra-box{
  margin-top:12px;
  background:white;
  border-radius:14px;
  padding:10px;
  border:1px solid #dbeafe;
  font-size:13px;
}

.credito{
  text-align:center;
  margin-top:18px;
  font-size:12px;
  color:#475569;
  opacity:0.8;
}

iframe{width:100%;border-radius:12px;margin-top:6px}
canvas{margin-top:18px;background:white;padding:8px;border-radius:12px}
</style>
</head>
<body>

<div class="container">
<h1>‚ùÑÔ∏è Viagem para Gramado</h1>

<select id="categoria">
<option>Passagem</option>
<option>Hotel</option>
<option>Alimenta√ß√£o</option>
<option>Passeios</option>
<option>Transporte</option>
<option>Outros</option>
</select>

<input type="text" id="nomeItem" placeholder="Nome do gasto/passeio">
<input type="number" id="valor" placeholder="Valor R$">

<select id="pagamento">
<option value="cartao">üí≥ Cart√£o</option>
<option value="dinheiro">üíµ Dinheiro</option>
</select>

<button class="primary" onclick="adicionarGasto()">Adicionar</button>
<button class="danger" onclick="limparTudo()">Limpar Tudo</button>

<div id="viagens"></div>

<div class="extra-box" id="countdownBox">‚è≥ Carregando contagem...</div>
<canvas id="grafico"></canvas>

<div class="extra-box" id="climaBox">üå°Ô∏è Carregando clima...</div>

<div class="extra-box">
üó∫Ô∏è Mapa de Gramado
<iframe height="200" src="https://maps.google.com/maps?q=Gramado%20RS&output=embed"></iframe>
</div>

<div class="credito">Criado por <strong>Matheus Damica</strong> ‚ú®</div>
</div>

<script>
let viagens = JSON.parse(localStorage.getItem("viagens")) || [{ destino:"Gramado", gastos:[] }];
let chart;

function salvar(){ localStorage.setItem("viagens", JSON.stringify(viagens)); }

function adicionarGasto(){
  const categoria = categoriaSel.value;
  const nome = nomeItem.value.trim();
  const valor = parseFloat(valorInput.value);
  const pagamentoTipo = pagamentoSel.value;
  if(!nome || !valor) return alert("Preencha tudo!");
  viagens[0].gastos.push({categoria,nome,valor,pago:false,pagamento:pagamentoTipo});
  salvar();
  renderizar();
  nomeItem.value="";
  valorInput.value="";
}

function togglePago(i){
  viagens[0].gastos[i].pago=!viagens[0].gastos[i].pago;
  salvar(); renderizar();
}

function toggleCategoria(id){
  const el=document.getElementById(id);
  el.style.display=el.style.display==="none"?"block":"none";
}

function limparTudo(){
  if(confirm("Apagar todos os gastos?")){
    viagens[0].gastos=[];
    salvar(); renderizar();
  }
}

function renderizar(){
  viagensDiv.innerHTML="";
  let total=0,pago=0,cartao=0,dinheiro=0,categoriasTotais={},grupos={};

  viagens[0].gastos.forEach((g,i)=>{
    if(!grupos[g.categoria]) grupos[g.categoria]=[];
    grupos[g.categoria].push({g,i});
    total+=g.valor;
    if(g.pago) pago+=g.valor;
    if(g.pagamento==="cartao") cartao+=g.valor; else dinheiro+=g.valor;
    categoriasTotais[g.categoria]=(categoriasTotais[g.categoria]||0)+g.valor;
  });

  let html=`<div class="viagem"><strong>Gramado</strong>`;
  for(const cat in grupos){
    const id=`cat-${cat}`;
    const totalCat=grupos[cat].reduce((s,o)=>s+o.g.valor,0);
    html+=`
    <div class="categoria-header" onclick="toggleCategoria('${id}')">
      <span>${cat}</span><span>R$${totalCat.toFixed(2)}</span>
    </div>
    <div class="gastos-lista" id="${id}">`;
    grupos[cat].forEach(obj=>{
      html+=`
      <div class="gasto ${obj.g.pago?"pago":""}">
        <span><input type="checkbox" ${obj.g.pago?"checked":""} onclick="togglePago(${obj.i})">
        ${obj.g.nome} (${obj.g.pagamento==="cartao"?"üí≥ Cart√£o":"üíµ Dinheiro"})</span>
        <span>R$${obj.g.valor.toFixed(2)}</span>
      </div>`;
    });
    html+=`</div>`;
  }

  let falta=total-pago;
  html+=`
  <div class="resumo">
  Total: R$${total.toFixed(2)}<br>
  Pago: R$${pago.toFixed(2)}<br>
  Falta: R$${falta.toFixed(2)}<br>
  üí≥ Cart√£o: R$${cartao.toFixed(2)}<br>
  üíµ Dinheiro: R$${dinheiro.toFixed(2)}
  </div></div>`;

  viagensDiv.innerHTML=html;
  atualizarGrafico(categoriasTotais);
}

function atualizarGrafico(dados){
  const ctx=document.getElementById('grafico');
  if(chart) chart.destroy();
  chart=new Chart(ctx,{type:'doughnut',data:{labels:Object.keys(dados),datasets:[{data:Object.values(dados)}]}});
}

fetch("https://api.open-meteo.com/v1/forecast?latitude=-29.37&longitude=-50.88&current_weather=true")
.then(r=>r.json())
.then(d=>climaBox.innerHTML=`üå°Ô∏è ${d.current_weather.temperature}¬∞C ‚Ä¢ Vento ${d.current_weather.windspeed} km/h`);

setInterval(()=>{
  const snow=document.createElement("div");
  snow.className="snowflake";
  snow.innerHTML="‚ùÑ";
  snow.style.left=Math.random()*window.innerWidth+"px";
  snow.style.animationDuration=(Math.random()*3+2)+"s";
  snow.style.fontSize=(Math.random()*10+10)+"px";
  document.body.appendChild(snow);
  setTimeout(()=>snow.remove(),5000);
},200);

const dataViagem = new Date("2027-01-04T00:00:00").getTime();
function atualizarContagem(){
  const agora = new Date().getTime();
  const diff = dataViagem - agora;
  if(diff<=0){ countdownBox.innerHTML="üéâ A viagem chegou!"; return;}
  const dias=Math.floor(diff/(1000*60*60*24));
  const horas=Math.floor((diff/1000/60/60)%24);
  const minutos=Math.floor((diff/1000/60)%60);
  const segundos=Math.floor((diff/1000)%60);
  countdownBox.innerHTML=`‚è≥ Faltam ${dias}d ${horas}h ${minutos}m ${segundos}s`;
}
setInterval(atualizarContagem,1000);

const categoriaSel=document.getElementById("categoria");
const nomeItem=document.getElementById("nomeItem");
const valorInput=document.getElementById("valor");
const pagamentoSel=document.getElementById("pagamento");
const viagensDiv=document.getElementById("viagens");
const climaBox=document.getElementById("climaBox");

renderizar();
</script>
</body>
</html>
